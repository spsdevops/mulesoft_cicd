name: 1 Deploy Develop ðŸš€

concurrency: develop

on:
  workflow_dispatch:  
  push:
    branches:
      - main
    
        
env:
  AMBIENTE: Develop
  VERSION: ${{ github.sha }}
  MULE_ENV: Develop

jobs:
  MuleDeploy:
    runs-on: ubuntu-22.04
    environment: Develop
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-java@v3
      with:
        distribution: 'temurin' # See 'Supported distributions' for available options
        java-version: '8'
        cache: 'maven'
    - uses: s4u/maven-settings-action@v2.6.0
      with:
        servers: '[{"id": "anypoint-exchange-v3", "username": "~~~Client~~~", "password": "${{secrets.MULE_CLIENT_ID}}~?~${{secrets.MULE_CLIENT_SECRET}}"}]'
    - name: "Construir y Publicar en Exchange"
      run: |
        mvn versions:set -DnewVersion=0.0.1-$VERSION
        mvn clean deploy -DskipTests -Dlicense.skip=true || echo "No se publico en exchange"
    - name: "Desplegar"
      run: mvn clean package deploy -Dlicense.skip=true -Dclientid=${{secrets.MULE_CLIENT_ID}} -Dclientsecret=${{secrets.MULE_CLIENT_SECRET}} -Dappname=sps-test-cicd-develop -Denvironment=Develop -DmuleDeploy
