name: 4 Redeploy üêõ

concurrency: production

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version üì¶'
        required: true
        type: string
      ambiente:
        description: 'Ambiente en el que se desplegar√° üì≠'
        required: true
        type: choice
        options:
          - develop
          - preprod
          - production
    
env:
  VERSION: ${{ inputs.version }}

jobs:
  MuleDeploy:
    runs-on: ubuntu-22.04
    environment: ${{ inputs.AMBIENTE }}
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: "Validar n√∫mero de versi√≥n"
      run: |
        echo "Version ${{inputs.version}}"
        [[ "${{inputs.version}}" =~ ^([0-9]|[1-9][0-9]*)\.([0-9]|[1-9][0-9]*)\.([0-9]|[1-9][0-9]*).*$ ]] && echo "Correcto" || exit 1
    
    - name: "Configurar Git"
      run: |
        git config --global user.name 'Github'
        git config --global user.email 'workflow@noreply.github.com'
        git branch --show-current
        git fetch
        git checkout releases/${{inputs.version}}
