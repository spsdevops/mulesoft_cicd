name: 1 Deploy Develop ðŸš€

concurrency: develop

on:
  workflow_dispatch:  
  push:
    branches:
      - main
    
        
env:
  AMBIENTE: develop
  VERSION: ${{ github.sha }}

jobs:
  MuleDeploy:
    runs-on: ubuntu-22.04
    environment: develop
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-java@v3
      with:
        distribution: 'temurin' # See 'Supported distributions' for available options
        java-version: '8'
        cache: 'maven'
    - uses: s4u/maven-settings-action@v2.6.0
      with:
        servers: '[{"id": "anypoint-exchange-v3", "username": "~~~Client~~~", "password": "${{secrets.MULE_CLIENT_ID}}~?~${{secrets.MULE_CLIENT_SECRET}}"}]'
    - name: "Construir y Publicar en Exchange"
      run: |
        mvn clean deploy -DskipTests -Dlicense.skip=true
    - name: "Desplegar"
      run: mvn clean package deploy -Dclientid=${{secrets.MULE_CLIENT_ID}} -Dclientsecret=${{secrets.MULE_CLIENT_SECRET}} -Denvironment=Sandbox -DmuleDeploy
